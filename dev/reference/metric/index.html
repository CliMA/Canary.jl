<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Metric Terms · Canary.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link href="../../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Canary.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../../">Home</a></li><li><a class="toctext" href="../../manual/dg_intro/">Introduction to DG</a></li><li><span class="toctext">Manual</span><ul><li><a class="toctext" href="../../manual/mesh/">Mesh</a></li><li><a class="toctext" href="../../manual/metric/">Metric Terms</a></li><li><a class="toctext" href="../../manual/operators/">Element Operators</a></li></ul></li><li><span class="toctext">Examples</span><ul><li><a class="toctext" href="../../examples/generated/advection/">Advection Equation Example</a></li><li><a class="toctext" href="../../examples/generated/shallow_water/">Shallow Water Equations Example</a></li></ul></li><li><span class="toctext">API Reference</span><ul><li><a class="toctext" href="../mesh/">Mesh</a></li><li class="current"><a class="toctext" href>Metric Terms</a><ul class="internal"></ul></li><li><a class="toctext" href="../operators/">Element Operators</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li>API Reference</li><li><a href>Metric Terms</a></li></ul><a class="edit-page" href="https://github.com/climate-machine/Canary.jl/blob/master/docs/src/reference/metric.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Metric Terms</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Metric-Terms-1" href="#Metric-Terms-1">Metric Terms</a></h1><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Canary.creategrid" href="#Canary.creategrid"><code>Canary.creategrid</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">creategrid(::Val{1}, elemtocoord::AbstractArray{S, 3},
           r::AbstractVector{T}) where {S, T}</code></pre><p>Create a grid using <code>elemtocoord</code> (see <a href="../mesh/#Canary.brickmesh"><code>brickmesh</code></a>) using the 1-D <code>(-1, 1)</code> reference coordinates <code>r</code>. The element grids are filled using bilinear interpolation of the element coordinates.</p><p>The grid is returned as a tuple of with <code>x</code> array</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L410-L419">source</a><div><div><pre><code class="language-none">creategrid(::Val{2}, elemtocoord::AbstractArray{S, 3},
           r::AbstractVector{T}) where {S, T}</code></pre><p>Create a 2-D tensor product grid using <code>elemtocoord</code> (see <a href="../mesh/#Canary.brickmesh"><code>brickmesh</code></a>) using the 1-D <code>(-1, 1)</code> reference coordinates <code>r</code>. The element grids are filled using bilinear interpolation of the element coordinates.</p><p>The grid is returned as a tuple of the <code>x</code> and <code>y</code> arrays</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L430-L439">source</a><div><div><pre><code class="language-none">creategrid(::Val{3}, elemtocoord::AbstractArray{S, 3},
           r::AbstractVector{T}) where {S, T}</code></pre><p>Create a 3-D tensor product grid using <code>elemtocoord</code> (see <a href="../mesh/#Canary.brickmesh"><code>brickmesh</code></a>) using the 1-D <code>(-1, 1)</code> reference coordinates <code>r</code>. The element grids are filled using bilinear interpolation of the element coordinates.</p><p>The grid is returned as a tuple of the <code>x</code>, <code>y</code>, <code>z</code> arrays</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L451-L460">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Canary.creategrid!" href="#Canary.creategrid!"><code>Canary.creategrid!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">creategrid!(x, elemtocoord, r)</code></pre><p>Create a 1-D grid using <code>elemtocoord</code> (see <a href="../mesh/#Canary.brickmesh"><code>brickmesh</code></a>) using the 1-D <code>(-1, 1)</code> reference coordinates <code>r</code>. The element grids are filled using linear interpolation of the element coordinates.</p><p>If <code>Nq = length(r)</code> and <code>nelem = size(elemtocoord, 3)</code> then the preallocated array <code>x</code> should be <code>Nq * nelem == length(x)</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L1-L10">source</a><div><div><pre><code class="language-none">creategrid!(x, y, elemtocoord, r)</code></pre><p>Create a 2-D tensor product grid using <code>elemtocoord</code> (see <a href="../mesh/#Canary.brickmesh"><code>brickmesh</code></a>) using the 1-D <code>(-1, 1)</code> reference coordinates <code>r</code>. The element grids are filled using bilinear interpolation of the element coordinates.</p><p>If <code>Nq = length(r)</code> and <code>nelem = size(elemtocoord, 3)</code> then the preallocated arrays <code>x</code> and <code>y</code> should be <code>Nq^2 * nelem == size(x) == size(y)</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L26-L35">source</a><div><div><pre><code class="language-none">creategrid!(x, y, z, elemtocoord, r)</code></pre><p>Create a 3-D tensor product grid using <code>elemtocoord</code> (see <a href="../mesh/#Canary.brickmesh"><code>brickmesh</code></a>) using the 1-D <code>(-1, 1)</code> reference coordinates <code>r</code>. The element grids are filled using trilinear interpolation of the element coordinates.</p><p>If <code>Nq = length(r)</code> and <code>nelem = size(elemtocoord, 3)</code> then the preallocated arrays <code>x</code>, <code>y</code>, and <code>z</code> should be <code>Nq^3 * nelem == size(x) == size(y) == size(z)</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L59-L69">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Canary.computemetric" href="#Canary.computemetric"><code>Canary.computemetric</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">computemetric(x::AbstractArray{T, 2}, D::AbstractMatrix{T}) where T</code></pre><p>Compute the 1-D metric terms from the element grid array <code>x</code> using the derivative matrix <code>D</code>. The derivative matrix <code>D</code> should be consistent with the reference grid <code>r</code> used in <a href="#Canary.creategrid!"><code>creategrid!</code></a>.</p><p>The metric terms are returned as a &#39;NamedTuple` of the following arrays:</p><ul><li><code>J</code> the Jacobian determinant</li><li><code>ξx</code> derivative ∂r / ∂x&#39;</li><li><code>sJ</code> the surface Jacobian</li><li>&#39;nx` outward pointing unit normal in <span>$x$</span>-direction</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L473-L486">source</a><div><div><pre><code class="language-none">computemetric(x::AbstractArray{T, 3}, y::AbstractArray{T, 3},
              D::AbstractMatrix{T}) where T</code></pre><p>Compute the 2-D metric terms from the element grid arrays <code>x</code> and <code>y</code> using the derivative matrix <code>D</code>. The derivative matrix <code>D</code> should be consistent with the reference grid <code>r</code> used in <a href="#Canary.creategrid!"><code>creategrid!</code></a>.</p><p>The metric terms are returned as a &#39;NamedTuple` of the following arrays:</p><ul><li><code>J</code> the Jacobian determinant</li><li><code>ξx</code> derivative ∂r / ∂x&#39;</li><li><code>ηx</code> derivative ∂s / ∂x&#39;</li><li><code>ξy</code> derivative ∂r / ∂y&#39;</li><li><code>ηy</code> derivative ∂s / ∂y&#39;</li><li><code>sJ</code> the surface Jacobian</li><li>&#39;nx` outward pointing unit normal in <span>$x$</span>-direction</li><li>&#39;ny` outward pointing unit normal in <span>$y$</span>-direction</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L506-L524">source</a><div><div><pre><code class="language-none">computemetric(x::AbstractArray{T, 3}, y::AbstractArray{T, 3},
              D::AbstractMatrix{T}) where T</code></pre><p>Compute the 3-D metric terms from the element grid arrays <code>x</code>, <code>y</code>, and <code>z</code> using the derivative matrix <code>D</code>. The derivative matrix <code>D</code> should be consistent with the reference grid <code>r</code> used in <a href="#Canary.creategrid!"><code>creategrid!</code></a>.</p><p>The metric terms are returned as a &#39;NamedTuple` of the following arrays:</p><ul><li><code>J</code> the Jacobian determinant</li><li><code>ξx</code> derivative ∂r / ∂x&#39;</li><li><code>ηx</code> derivative ∂s / ∂x&#39;</li><li><code>ζx</code> derivative ∂t / ∂x&#39;</li><li><code>ξy</code> derivative ∂r / ∂y&#39;</li><li><code>ηy</code> derivative ∂s / ∂y&#39;</li><li><code>ζy</code> derivative ∂t / ∂y&#39;</li><li><code>ξz</code> derivative ∂r / ∂z&#39;</li><li><code>ηz</code> derivative ∂s / ∂z&#39;</li><li><code>ζz</code> derivative ∂t / ∂z&#39;</li><li><code>sJ</code> the surface Jacobian</li><li>&#39;nx` outward pointing unit normal in <span>$x$</span>-direction</li><li>&#39;ny` outward pointing unit normal in <span>$y$</span>-direction</li><li>&#39;nz` outward pointing unit normal in <span>$z$</span>-direction</li></ul><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"></div></div><p>The storage of the volume terms and surface terms from this function are    slightly different. The volume terms used Cartesian indexing whereas the    surface terms use linear indexing.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L548-L578">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Canary.computemetric!" href="#Canary.computemetric!"><code>Canary.computemetric!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-none">computemetric!(x, J, ξx, sJ, nx, D)</code></pre><p>Compute the 1-D metric terms from the element grid arrays <code>x</code>. All the arrays are preallocated by the user and the (square) derivative matrix <code>D</code> should be consistent with the reference grid <code>r</code> used in <a href="#Canary.creategrid!"><code>creategrid!</code></a>.</p><p>If <code>Nq = size(D, 1)</code> and <code>nelem = div(length(x), Nq)</code> then the volume arrays <code>x</code>, <code>J</code>, and <code>ξx</code> should all have length <code>Nq * nelem</code>.  Similarly, the face arrays <code>sJ</code> and <code>nx</code> should be of length <code>nface * nelem</code> with <code>nface = 2</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L109-L119">source</a><div><div><pre><code class="language-none">computemetric!(x, y, J, ξx, ηx, ξy, ηy, sJ, nx, ny, D)</code></pre><p>Compute the 2-D metric terms from the element grid arrays <code>x</code> and <code>y</code>. All the arrays are preallocated by the user and the (square) derivative matrix <code>D</code> should be consistent with the reference grid <code>r</code> used in <a href="#Canary.creategrid!"><code>creategrid!</code></a>.</p><p>If <code>Nq = size(D, 1)</code> and <code>nelem = div(length(x), Nq^2)</code> then the volume arrays <code>x</code>, <code>y</code>, <code>J</code>, <code>ξx</code>, <code>ηx</code>, <code>ξy</code>, and <code>ηy</code> should all be of size <code>(Nq, Nq, nelem)</code>.  Similarly, the face arrays <code>sJ</code>, <code>nx</code>, and <code>ny</code> should be of size <code>(Nq, nface, nelem)</code> with <code>nface = 4</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L143-L154">source</a><div><div><pre><code class="language-none">computemetric!(x, y, z, J, ξx, ηx, ζx, ξy, ηy, ζy, ξz, ηz, ζz, sJ, nx,
               ny, nz, D)</code></pre><p>Compute the 3-D metric terms from the element grid arrays <code>x</code>, <code>y</code>, and <code>z</code>. All the arrays are preallocated by the user and the (square) derivative matrix <code>D</code> should be consistent with the reference grid <code>r</code> used in <a href="#Canary.creategrid!"><code>creategrid!</code></a>.</p><p>If <code>Nq = size(D, 1)</code> and <code>nelem = div(length(x), Nq^3)</code> then the volume arrays <code>x</code>, <code>y</code>, <code>z</code>, <code>J</code>, <code>ξx</code>, <code>ηx</code>, <code>ζx</code>, <code>ξy</code>, <code>ηy</code>, <code>ζy</code>, <code>ξz</code>, <code>ηz</code>, and <code>ζz</code> should all be of length <code>Nq^3 * nelem</code>.  Similarly, the face arrays <code>sJ</code>, <code>nx</code>, <code>ny</code>, and <code>nz</code> should be of size <code>Nq^2 * nface * nelem</code> with <code>nface = 6</code>.</p><p>The curl invariant formulation of Kopriva (2006), equation 37, is used.</p><p>Reference:   Kopriva, David A. &quot;Metric identities and the discontinuous spectral element   method on curvilinear meshes.&quot; Journal of Scientific Computing 26.3 (2006):   301-327. <a href="https://doi.org/10.1007/s10915-005-9070-8">https://doi.org/10.1007/s10915-005-9070-8</a></p></div></div><a class="source-link" target="_blank" href="https://github.com/climate-machine/Canary.jl/blob/52bc788b55b4fd87c47a4b9ee769129c9e86f386/src/metric.jl#L231-L250">source</a></section><footer><hr/><a class="previous" href="../mesh/"><span class="direction">Previous</span><span class="title">Mesh</span></a><a class="next" href="../operators/"><span class="direction">Next</span><span class="title">Element Operators</span></a></footer></article></body></html>
